# 4. 操作符

- [4. 操作符](#4-操作符)
  - [4.1. 使用Java操作符](#41-使用java操作符)
  - [4.2. 优先级](#42-优先级)
  - [4.3. 赋值](#43-赋值)
  - [4.4. 算术操作符](#44-算术操作符)
    - [4.4.1. 一元加操作符和一元减操作符](#441-一元加操作符和一元减操作符)
  - [4.5. 自动递增和自动递减](#45-自动递增和自动递减)
  - [4.6. 关系操作符](#46-关系操作符)
  - [4.7. 逻辑操作符](#47-逻辑操作符)
    - [4.7.1. 短路](#471-短路)
  - [4.8. 字面量](#48-字面量)
    - [4.8.1. 字面量里的下划线](#481-字面量里的下划线)
    - [4.8.2. 科学记数法（又称“指数记数法”）](#482-科学记数法又称指数记数法)

## 4.1. 使用Java操作符

- 操作符接收一个或多个参数，然后生成一个新的值。
- 所有操作符都是通过它们的操作数来生成新值的。
- 另外，有些`操作符会修改操作数自身的值`，这也叫作“副作用”。
- 几乎所有的操作符都只能操作基本类型。例外的是`=`、`==`和`!=`，它们也能操作对象。另外，`String`类也支持`+`和`+=`；

## 4.2. 优先级

- 当多个操作符同时存在时，操作符的优先级决定了表达式的计算顺序。
- Java对计算顺序做了特别规定。最简单的规则就是先`乘除后加减`。
- 程序员经常会忘记其他优先级规则，可以用`括号来明确指定计算顺序`。

## 4.3. 赋值

- 操作符`=`号用来赋值。它的意思是“取等号右边的值（称‘右值’），把它复制给等号左边（称‘左值’）”。
- 右值可以是任何常量、变量或者可以生产值的表达式。左值必须是一个独特的命名变量（也就是说，必须有一个物理空间来存储右值）。
- 基本类型的赋值是很直观的。基本类型存储了实际的值，而非指向一个对象的引用，所以在赋值时，直接将一个地方的内容**复制**到另一个地方。
- 对象赋值时，我们`真正操作的是这个对象的引用`。所以当“将一个对象赋值给另一个对象”时，其实是将这个引用从一个地方赋值到另一个地方。这种现象通常称作`别名`，是Java操作对象的一种基本方式。
- 方法调用中的别名：将一个对象作为参数传递给方法时，也会产生别名。

## 4.4. 算术操作符

- Java的基本算术操作符与其他大多数编程语言相同，包括：加法（+）、减法（-）、乘法（*）、除法（/）和取模（%，它从除法中产生余数）。

- 快捷运算符，可以同时进行运算和赋值操作。比如，把 x 加4，然后将结果赋回给x，可以这么写：`x += 4`；

> 为了生成随机数，上面的程序首先创建了一个 `Random` 对象。如果创建时没有传递任何参数，Java会使用当前时间作为随机生成器的种子，这样就能在程序每次执行时产生不同的输出。通过在创建Random对象时提供种子（用作在每次执行程序时都生成相同的随机数）。

### 4.4.1. 一元加操作符和一元减操作符

- 一元减（-）和一元加（+）与二元加减使用的是相同的符号。编译器会根据表达式的书写形式自动判断出使用的是哪一种。例如：`x = a * -b`; 但是阅读者可能会被搞糊涂，所以应该更明确地写成： `x = a * (-b)`；

## 4.5. 自动递增和自动递减

- Java也提供了大量的快捷运算符，这些快捷运算符方便了代码输入，如果用得好会使代码更容易阅读，但有时也可能使代码更难理解。

- 递减操作符是`--`，意为“减少一个单位”；递增操作符是`++`，意为“增加一个单位”；

- 递增和递减操作符有两种使用方式，通常称为`前缀式`和`后缀式`.
  - `前缀递增`表示++操作符位于变量之前；例如：`++i`；程序会先执行运算，然后返回生成的结果；
  - `后缀递增`表示++操作符位于变量之后；例如：`i++`；程序则会先返回变量的值，然后再执行运算；

``` java
public class AutoInc {
  public static void main(String args[]) {
    int i = 1;
    System.out.println("i: " + i); // i: 1
    System.out.println("++i: " + ++i); // 前缀递增 ++i: 2
    System.out.println("i++: " + i++); // 后缀递增 i++: 2
    System.out.println("i: " + i); // i: 3
    System.out.println("--i: " + --i); // 前缀递减 --i: 2
    System.out.println("i--: " + i--); // 后缀递减 i--: 2
    System.out.println("i: " + i); // i: 1
  }
}
```

> 注意： 对于前缀形式，我们在执行完运算后才得到返回值。但对于后缀形式，则是先获得返回值再执行运算；

## 4.6. 关系操作符

- 关系操作符会根据操作数的值之间的关系生成一个布尔结果。
- 如果关系为真，关系表达式生成true；如果关系不为真，则生成false。
- 关系操作符包括小于（<）、大于（>）、小于等于（<=）、大于等于（>=）、等于（==）以及不等于（!=）。

- 测试对象是否相等，如下代码：

  ``` java
  public class Equivalence { // 对等，等效
      static void show(String desc, Integer n1, Integer n2) {
          System.out.println(desc + ":");
          System.out.printf("%d==%d %b %b%n", n1, n2, n1 == n2, n1.equals(n2));
      }

      public static void test(int value) {
          Integer i1 = value; // 1 自动转换为Integer
          Integer i2 = value;
          show("Automatic", i1, i2);
          Integer r1 = new Integer(value); // 2 使用new的方式
          Integer r2 = new Integer(value);
          show("new Integer()", r1, r2);
          Integer v1 = Integer.valueOf(value); // 3 使用valueOf()
          Integer v2 = Integer.valueOf(value);
          show("Integer.valueOf()", v1, v2);
          int x = value; // 4 基本类型
          int y = value;
          System.out.println("Primitive int");
          System.out.printf("%d==%d %b%n", x, y, x == y);
      }

      public static void main(String[] args) {
          test(127);
          test(128);
      }
  }
  /* output : 
  Automatic:
  127==127 true true
  new Integer():
  127==127 false true
  Integer.valueOf():
  127==127 true true
  Primitive int
  127==127 true
  Automatic:
  128==128 false true
  new Integer():
  128==128 false true
  Integer.valueOf():
  128==128 false true
  Primitive int
  128==128 true
  */
  ```

- 代码说明：
  - 在`test()`中，整数值对象以4种不同的方式创建。
    1. 自动转换为Integer。 实际是通过 `Integer.valueOf()` 的自动调用来完成的。
    2. 使用`new`菜创建Integer对象。**注意：Java 9 已经弃用，建议使用 Integer.valueOf()**；
    3. 从Java 9 开始，valueOf()优于【2】。
    4. 基本类型int也可以当作整数值对象使用。

> **对于参数值127来说**， 出于效率原因，Integer会通过享元模式（Flyweight Pattern，主要用于减少创建对象的数量，以减少内存占用和提高性能。 这种类型的设计模式属于结构型模式，它提供了减少对象数量从而改善应用所需的对象结构的方式。 享元模式尝试重用现有的同类对象，如果未找到匹配的对象，则创建新对象。）来缓存范围在 -128~127内的对象，因此多次调用Integer.value(127)生成的其实是同一个对象。

## 4.7. 逻辑操作符

- 逻辑操作符“与”（&&）、“或”（||） 和“非”（!）可以根据参数的逻辑关系，生成一个true或false的布尔值。

- *“与”、“或”、“非”操作只可应用于布尔值。不能将逻辑表达中将一个非布尔值当作布尔值使用。*
- *可以将int类型替换成除boolean类型外的其他任何基本数据类型。*

### 4.7.1. 短路

- 逻辑操作符支持一种称为“短路”的现象。一旦表达式当前部分的计算结果能够明确无误地确定整个表达式的值，表达式余下部分就不会被执行了。

## 4.8. 字面量

- 一般来说，如果程序里使用了一个字面量（literal value）,则编译器能准确地知道它是什么类型的。不然当类型模棱两可的时候，你就必须使用该字面量相关的一些字符，以此添加额外信息来引导编译器。

| 类型     | 开头   | 结尾 | 举例        |
| -------- | ------ | ---- | ----------- |
| 十六进制 | 0x     |      | 0x2f、 0x2F |
| 八进制   | 0      |      | 0177        |
| 二进制   | 0b或0B |      | 0b00110101  |
| long     |        | l或L | 1l、 1L     |
| float  |        | f或F | 1f、1L      |
| double  |        | d或D | 1d、1D      |

- Java 7 引入了二进制字面量，通过前缀0b或0B来表示；

### 4.8.1. 字面量里的下划线

- Java7中增加的新功能：可以在数字字面量里使用下划线，这样更易于阅读。

``` java
double d = 341_435_936.445_667;
int bin = 0b0010_1111_1010_1111;
```

- 这里有几条合理的规则：
  1. 只能使用单个下划线，不能连续使用多个；
  2. 数字的开头或结尾不能有下划线；
  3. 想F、D或L这样的后缀周围不能有下划线；
  4. 在二进制或十六进制标识符b和x的周围不能有下划线。

### 4.8.2. 科学记数法（又称“指数记数法”）

- 例如：`float f4 = 1e-43f;`
